<div ng-show="changes.length">
  <h3>{{I18n.t('products.latest_actions')}}</h3>
  <table>
    <tr>
      <th>{{I18n.t('products.name')}}</th>
      <th>{{I18n.t('products.change_by')}}</th>
      <th>{{I18n.t('generic.change')}}</th>
    </tr>
    <tr ng-repeat="change in changes">
      <td>{{change.product.name}}</td>
      <td>{{change.user.username}}</td>
      <td>{{change.change}}</td>
    </tr>
  </table>
</div>
<div>
  <h3>{{I18n.t('products.header')}}</h3>
  <div class="search">
    <span>{{I18n.t('generic.search_by_name')}}</span>
    <input type="text" ng-model="currentProductText" ng-change="filter(products.collection, 'name', currentProductText)"
           ng-list value="{{currentProductText}}" ng-init="filter(products.collection, 'name', '')"/>
  </div>
 <table>
   <tr>
     <th>{{I18n.t('products.name')}}</th>
     <th>{{I18n.t('products.group')}}</th>
     <th>{{I18n.t('materials.other')}}</th>
   </tr>
   <tr class="clickable" ng-repeat="product in products.collection" ng-click="products.select(product); product.editing=false" >
     <td>{{product.name}}</td>
     <td>{{I18n.t('products.groups.'+product.group)}}</td>
     <td>
       <div ng-repeat="entry in product.materials">
         <span>{{entry.amount}}</span>
         <span>{{entry.material.name}}</span>
       </div>
     </td>
   </tr>
 </table>
</div>
<div>
  <h3>{{I18n.t('materials.other')}}</h3>
  <div class="search">
    <span>{{I18n.t('generic.search_by_name')}}</span>
    <input type="text" ng-model="currentMaterialText" ng-change="filter(materials.collection, 'name', currentMaterialText)"
           ng-list value="{{currentMaterialText}}" ng-init="filter(materials.collection, 'name', '')"/>
  </div>
  <table>
    <tr>
      <th>{{I18n.t('materials.name')}}</th>
      <th>{{I18n.t('materials.unit')}}</th>
      <th>{{I18n.t('materials.group')}}</th>
      <th>{{I18n.t('materials.price')}}</th>
      <th>{{I18n.t('materials.stock')}}</th>
    </tr>
    <tr class="clickable" ng-repeat="material in materials.collection" ng-click="materials.edit(product)" >
      <td>{{material.name}}</td>
      <td>{{I18n.t('materials.units.'+material.unit)}}</td>
      <td>{{I18n.t('materials.groups.'+material.group)}}</td>
      <td>{{material.price}}</td>
      <td>{{material.stock}}</td>
    </tr>
  </table>
</div>

<div class="selection_window" ng-show="products.isSelected()">
  <div class="header">
    <button ng-click="products.unselect()">X</button>
    <h3>{{I18n.t('products.details', {product: products.selected.name})}}</h3>
  </div>
  <ul>
    <li>
      <h4>{{I18n.t('products.name')}}</h4>
      <span  class="content" ng-hide="products.editing">{{products.selected.name}}</span>
      <input ng-show="products.editing" ng-model="products.selected.name" />
    </li>
    <li>
      <h4>{{I18n.t('products.unit')}}</h4>
      <span  class="content" ng-hide="products.editing">{{I18n.t('products.units.'+products.selected.unit)}}</span>
      <select ng-show="products.editing" ng-model="products.selected.unit"
              ng-options="unit as lunit for (unit, lunit) in products.localized_units" ng-change="update()"></select>

    </li>
    <li>
      <h4>{{I18n.t('products.group')}}</h4>
      <span  class="content" ng-hide="products.editing">{{I18n.t('products.groups.'+products.selected.group)}}</span>
      <select ng-show="products.editing" ng-model="products.selected.group"
              ng-options="group as lgroup for (group, lgroup) in products.localized_groups" ng-change="update()"></select>
    </li>
    <li>
      <h4>{{I18n.t('products.stock')}}</h4>
      <span  class="content">{{products.selected.stock}}</span>
    </li>
    <li>
      <h4>{{I18n.t('products.description')}}</h4>
      <p ng-hide="products.editing" ng-show="products.description">{{products.selected.description}}</p>
      <p ng-hide="products.editing" ng-hide="products.selected.description">{{I18n.t('products.no_description')}}</p>
      <textarea ng-show="products.editing" ng-model="products.selected.description"  ng-change="products.update()"></textarea>
    </li>
    <li>
      <h4>{{I18n.t('materials.other')}}</h4>
      <div ng-repeat="entry in products.selected.materials" ng-hide="products.editing">
        <p>{{entry.amount}} {{entry.material.name}}</p>
      </div>
      <div ng-repeat="entry in products.selected.materials" ng-hide="entry.hidden" ng-show="products.editing">
        <div>
          <button class="small decrement" ng-click="decrementByOne(entry, 'amount'); update()">-</button>
          <input  id="entry_{{entry.id}}" class="number-box" type="text"
                  ng-model="entry.amount" ng-pattern="/^[1-9]+$/" ng-change="update()"/>
          <button class="small increment" ng-click="incrementByOne(entry, 'amount'); update()">+</button>
        <label for="entry_{{entry.id}}">{{entry.material.name}}</label>
        <button ng-click="removeEntry($index)">{{I18n.t('generic.remove')}}</button>
        </div>
        <div>
          <button class="small decrement" ng-click="decrementByOne(new_entry, 'amount')">-</button>
          <input class="number-box" type="text" ng-model="new_entry.amount"
                 ng-init="new_entry={amount:1}" ng-pattern="/^[1-9]+$/" ng-change="update()"/>
          <button class="small increment" ng-click="incrementByOne(new_entry, 'amount')">+</button>
          <select ng-model="new_entry.material" ng-options="m.name for m in materials">
            </select>
          <button ng-click="addEntry(new_entry)">{{I18n.t('generic.add')}}</button>
        </div>
      </div>
    </li>
  </ul>
  <div class="buttons">
    <button ng-click="products.editing=true" ng-hide="products.editing">{{I18n.t('generic.edit')}}</button>
    <button ng-click="products.editing=false" ng-show="products.editing">{{I18n.t('generic.cancel')}}</button>
  </div>
</div>